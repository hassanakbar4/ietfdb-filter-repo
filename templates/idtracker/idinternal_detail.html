{# Copyright The IETF Trust 2007, All Rights Reserved #}
{% extends "idtracker/base.html" %}

{% load ietf_filters %}     

{% block title %}-- {{ docObj.filename }}{% endblock %}

{% block head %}
<link rel="alternate" type="application/atom+xml" href="/feed/comments/{{ docObj.filename }}/">
{% endblock %}

{% block idcontent %}
    <table width="90%" cellpading="1" cellspacing="0">
      <tr>
        <td bgcolor="000000">
          <table width="100%" cellspacing="0" cellpading="5">
            <tr bgcolor="BEBEBE" align="center">
              <th colspan="2">
                <div class="largefont">
               {% if adding %}
                  Add Draft 
               {% else %}
                  Detail Info
               {% endif %}
               {% if resurrection_needed %}
                 <br><br>
                 <font color="red">*** EXPIRED ***</font><br>
                 <form method="GET" action="{% url ietf.idtracker.views.resurrect_id docObj.filename %}">You can't process and expired I-D {% if object.resurrect_requested_by %}Resurrection was requested by {{ object.resurrect_requested_by }} {% else %}<input type="submit" value="resurrect it first">{% endif %}</form>
               {% endif %}
                </div>
		{% if object.ballot_others.count %}
		<div align="right">
		  <a href="#action">Action List</a>
		</div>
		{% endif %}
              </th>
            </tr>
            {% ifnotequal mode 'IETF' %}
            <form action="{% url ietf.idtracker.views.view_id docObj.filename %}" method="post">
              {% if ballot_id %}
              <input type="hidden" name="ballot_id" value="{{ballot_id}}">
              {% endif %}
            {% endifnotequal %}
            <tr bgcolor="white">
              <td>
                <div class="largefont{{fontsize}}">
                  {{ docObj.doctype }} Name:
                </div>
              </td>

              <td>
                <div class="largefont{{fontsize}}">
                {% if not adding %}
		  {{ object.document.displayname_with_link }}
		  {% ifequal object.document.doctype "Draft" %}
		    {% ifnotequal object.document.status.status "Active" %}
		      ({{ object.document.status.status }})
		    {% endifnotequal %}
		  {% endifequal %}
		  <font color="red">
		  {% if object.via_rfc_editor %}
		    (Independent submission via RFC Editor)
		  {% else %}
		    {% ifequal object.document.group_acronym "none" %}
		      (Individual submission)
		    {% else %}
		      (WG &lt;{{ object.document.group_acronym }}&gt; submission)
		    {% endifequal %}
		  {% endif %}
                  </font>
		  {% ifequal object.document.status.status "Replaced" %}
		    <br>Replaced by
		    {% if object.document.replaced_by.idinternal %}
		      <a href="{{ object.document.replaced_by.idinternal.get_absolute_url }}">
		    {% endif %}
		    {{ object.document.replaced_by.filename }}
		    {% if object.document.replaced_by.idinternal %}
		      </a>
		    {% endif %}
		  {% endifequal %}
		  {% if object.document.replaces_set.count %}
		    <br>Replaces
		    {% for replaces in object.document.replaces_set.all %}
		      {% if replaces.idinternal %}
		        <a href="{{ replaces.idinternal.get_absolute_url }}">
		      {% endif %}
		      {{ replaces.filename }}{% if replaces.idinternal %}</a>{% endif %}{% if not forloop.last %},{% endif %}
		    {% endfor %}
		  {% endif %}
               {% else %}
                   {{ docObj.filename }}
               {% endif %}
                </div>
              </td>
            </tr>
{% if not adding %}
            <tr bgcolor="white">
              <td>
                <div class="largefont{{fontsize}}">
                  IESG Discussion: {{ mode }}
                </div>
              </td>

              <td>
                <div class="largefont{{fontsize}}">
                  {% ifequal mode 'IETF' %}
		    {% if object.ballot.ballot_issued %}
                    <a href="{% url ietf.idtracker.views.view_ballot object.ballot_id %}">IESG evaluation record</a>
                    [<a href="/idtracker/help/evaluation/">What
                    they mean</a>]
                    [<a href="/idtracker/help/ballot/">How they are
                    recorded</a>]
		    {% else %}
		    No IESG evaluation record
                    {% endif %}
                  {% else %}
		    {% if object.ballot.ballot_issued %}
                    <a href="{% url ietf.idtracker.views.view_ballot object.ballot_id %}">[Open Web Ballot]</a>
                    {% endif %}
                    <a href="{% url ietf.idtracker.views.view_ballot_writeup object.ballot_id %}">{% if ballot_writeup  %}[Ballot Write-ups]{% else %}[Preapare for Last Call]{% endif %}</a>
		  {% endifequal %}
                </div>
              </td>
            </tr>
{% endif %}
            <tr bgcolor="white">
              <td>
                <div class="largefont{{fontsize}}">
                  Version:
                </div>
              </td>

              <td>
                <div class="largefont{{fontsize}}">
                  {{ docObj.revision }}
                </div>
              </td>
            </tr>

            <tr bgcolor="white">
              <td>
                <div class="largefont{{fontsize}}">
                  Intended Status:
                </div>
              </td>

              <td>
                <div class="largefont{{fontsize}}">
                  {% ifequal mode 'IETF' %}
                  {{ docObj.intended_status }}
                  {% else %}
                  {{ idform.intended_status }}
                  {% endifequal %}
                </div>
              </td>
            </tr>
{% ifequal docObj.group_acronym "none" %}
            <tr bgcolor="white">
              <td>
                <div class="largefont{{fontsize}}">
                  Area:
                </div>
              </td>

              <td>
                <div class="largefont{{fontsize}}">
                  {% ifequal mode 'IETF' %}
                  {{ object.area_acronym }}
                  {% else %}
                  {{ idform.area }}
                  {% endifequal %}
                </div>
              </td>
            </tr>
{% endifequal %}
            <tr bgcolor="white">
              <td>
                <div class="largefont{{fontsize}}">
                  On Next Agenda?
                </div>
              </td>

              <td>
                <div class="largefont{{fontsize}}">
                  {% ifequal mode 'IETF' %}
                  {{ object.agenda|yesno:"Yes,No" }}
                  {% else %}
                  {{ idform.agenda }} on 
                  {{idform.telechat_date}}
                  {% endifequal %}
                </div>
              </td>
            </tr>
{% if not adding %}
            {% ifnotequal mode 'IETF' %}
            <tr bgcolor="white">
              <td>
                <div class="largefont{{fontsize}}">
                  Previous State:
                </div>
              </td>

              <td>
                <div class="largefont{{fontsize}}">
                  <a href="/idtracker/help/state/{{ object.prev_state_id }}/">
                  {{ object.prev_state }}</a>
                  {% if object.prev_sub_state %}
                  ::
                  <a href="/idtracker/help/substate/{{ object.prev_sub_state_id }}/">
                  {{ object.prev_sub_state }}
                  </a>
                  {% endif %}
                  {% if object.rfc_flag %}
                  {% else %}
                  {% ifequal object.cur_state.state "RFC Ed Queue" %}
                  <a href="http://www.rfc-editor.org/queue.html#{{ docObj.filename }}">
                  [RFC Editor State]</a>
                  {% endifequal %}
                  {% endif %}
                </div>
                {% ifequal mode 'IETF' %}
                <a href="/idtracker/help/state/">
                [Show States Table]</a>
                {% endifequal %}
              </td>
            </tr>
            {% endifnotequal %}
{% endif %}

            <tr bgcolor="white">
              <td>
                <div class="largefont{{fontsize}}">
                  Current State:
                </div>
              </td>

              <td>
                <div class="largefont{{fontsize}}">
               {% if not adding %}
                  <a href="/idtracker/help/state/{{ object.cur_state_id }}/">
                  {{ object.cur_state }}</a>
		  {% if object.cur_sub_state %}
		  ::
		  <a href="/idtracker/help/substate/{{ object.cur_sub_state_id }}/">
		  {{ object.cur_sub_state }}
		  </a>
		  {% endif %}
		  {% if object.rfc_flag %}
		  {% else %}
		  {% ifequal object.cur_state.state "RFC Ed Queue" %}
		  <a href="http://www.rfc-editor.org/queue.html#{{ docObj.filename }}">
                  [RFC Editor State]</a>
		  {% endifequal %}
		  {% endif %}
               {% else %}
                {{ idform.next_state }} with sub state in {{ idform.next_sub_state }}
               {% endif %}
                </div>
                {% ifequal mode 'IETF' %}
                <a href="/idtracker/help/state/">
                [Show States Table]</a> 
                {% endifequal %}
              </td>
            </tr>
{% if not adding %}
            {% ifnotequal mode 'IETF' %}
            <tr bgcolor="white">
              <td>
                <div class="largefont{{fontsize}}">
                  Next State:
                </div>
              </td>

              <td>
                <div class="largefont{{fontsize}}">
                {{ idform.next_state }} with sub state in {{ idform.next_sub_state }}
                <a href="/idtracker/help/state/">
                Show States Table</a>
                </div>
                or <br>
                {% for state in next_state_object %}
                  <input type="submit" value="{{ state.next_state.state }}" name="next_state_button">
                {% endfor %}<br>
                or <br>
                <input type="submit" value="Back to Previous State" name="back_to_previous">
              </td>
            </tr>
            {% endifnotequal %}
{% endif %}
            <tr bgcolor="white">
              <td>
                <div class="largefont{{fontsize}}">
                  Responsible AD:
                </div>
              </td>

              <td>
                <div class="largefont{{fontsize}}">
                  {% ifequal mode 'IETF' %}
                  {{ object.job_owner }}
                  {% else %}
                  {{idform.job_owner}}
                  {% endifequal %}
                </div>
              </td>
            </tr>

            <tr bgcolor="white">
              <td>
                <div class="largefont{{fontsize}}">
                  Status Date:
                </div>
              </td>

              <td bgcolor="white">
                <div class="largefont{{fontsize}}">
                  {% ifequal mode 'IETF' %}
                  {% firstof object.status_date "&nbsp;" %}
                  {% else %}
                  {{idform.status_date}}
                  {% endifequal %}
                </div>
              </td>
            </tr>

            <tr bgcolor="white">
              <td>
                <div class="largefont{{fontsize}}">
                  Note:
                </div>
              </td>

              <td>
                <div class="largefont{{fontsize}}">
                  {% ifequal mode 'IETF' %}
		  {# |unformat_textarea #}
                  {% firstof object.note &nbsp; %}
                  {% else %}
                  {{idform.note}}
                  {% endifequal %}
                </div>
              </td>
            </tr>
            {% ifnotequal mode 'IETF' %}
            <tr bgcolor="white">
              <td>
                <div class="largefont{{fontsize}}">
                  Comment:
                </div>
              </td>

              <td>
                <div class="largefont{{fontsize}}">
                {{idform.comment}}
                {{idform.public_flag}} Public
                </div>
              </td>
            </tr>
            <tr bgcolor="white">
              <td>
                <div class="largefont{{fontsize}}">
                  State or Version Change<br>Notice To:
                </div>
              </td>

              <td>
                <div class="largefont{{fontsize}}">
                {{idform.state_change_notice_to}}<b>comma must exists between email addresses</b>
                </div>
              </td>
            </tr>
            {% endifnotequal %}
            <tr bgcolor="white">
              <td width="20%">
              {% ifnotequal mode 'IETF' %}
              <input type="submit" value="{% if adding %}Submit{% else %}Update{% endif %}"{% if resurrection_needed %} OnClick="alert('You can not process an expired I-D');return false;"{% endif %}>
              <input type="reset" value="RESET">
              </form>
              {% else %}
              &nbsp;
              {% endifnotequal %}
              </td>
              <td>
              {% if not adding %}
                <table cellpadding="1" cellspacing="1" border="0">
                  <tr>
                  {% ifnotequal mode 'IETF' %}
                    <td>
                      <form action="{% url ietf.idtracker.views.search %}" method="GET"><input type="hidden" name="ballot_id" value="{{ object.ballot_id }}">
                        <input type="submit" value="Add a document to this ballot"{% if resurrection_needed %} OnClick="alert('You can not process an expired I-D');return false;"{% endif %}>
                      </form>
                    </td>
                  {% if not object.primary_flag %}
                    <td>
                      <form action="{% url ietf.idtracker.views.view_id docObj.filename %}" method="GET">
                        <input type="submit" value="Separate from Ballot Set" name="separate_ballot"{% if resurrection_needed %} OnClick="alert('You can not process an expired I-D');return false;"{% endif %}>
                      </form>
                    </td>
                  {% endif %}
                  {% endifnotequal %}

                    <td>
                      <form action="{% url ietf.idtracker.views.search %}" method="GET">
			<input type="submit" value="Main Menu">
                      </form>
                    </td>
                  </tr>
                </table>
              {% endif %}
              </td>
            </tr>
          </table>
	</td>
      </tr>
    </table>

    {% if object.ballot_others.count %}
    <a name="action"></a>
    <table border="1" bgcolor="black">
    <tr><td><font color="white"><h3>Actions</h3></font>
    {% regroup object.ballot_set by docstate as grouped %}
    {% include "idtracker/search_result_table.html" %}
    </td>
    </tr>
    </table>
    {% endif %}
{% if not adding %}
    <h3>Comment Log <span style="font-size: 80%">[<a href="/feed/comments/{{ docObj.filename }}/">atom feed</a>]</span></h3>

    <table cellpadding="1" cellspacing="1" border="0">
      <tr bgcolor="#7DC189">
	<th>Date</th>

	<th>Version</th>

	<th>Comment</th>
      </tr>

{% for comment in object.all_comments %}
  {% if comment.public_flag %}
      <tr bgcolor="{% cycle #CFE1CC,#7DC189 %}">
	<td>{{ comment.date }}</td>

	<td align="center">{{ comment.version }}</td>

	<td>
<font color="blue">[{% ifnotequal mode 'IETF' %}public-{% endifnotequal %}{{ comment.get_username }}]</font>
{% if comment.ballot %}
	  <font color="red">[IN IESG DISCUSSION
	    <b>*{{ comment.get_ballot_display }}*</b>]</font>
{% endif %} {{ comment.comment_text|format_textarea|truncatewords_html:"25" }}</td>

        <!-- this form element technically belongs inside the <td>
             but that actually changes the visible spacing in most
             browsers, so we let layout concerns make us write
             invalid HTML. -->
	<form action="{{ comment.get_absolute_url }}" method="GET">
	  <td>
	    <input type="submit" value="View Detail">
	  </td>
	</form>
{% ifequal comment.get_username user.username %}
        <form action="." method="GET">
           <td>
            <input type="hidden" name="objectid" value="{{ comment.id }}">
            <input type="submit" value="Toggle Private/Public" name="toggle_public_flag">
          </td> 
        </form>
{% endifequal %}
      </tr>
  {% else %}
    {% ifnotequal mode 'IETF' %}
      <tr bgcolor="{% cycle #CFE1CC,#7DC189 %}">
        <td>{{ comment.date }}</td>

        <td align="center">{{ comment.version }}</td>

        <td>
<font color="red">[private-{{ comment.get_username }}]</font>
{% if comment.ballot %}
          <font color="red">[IN IESG DISCUSSION
            <b>*{{ comment.get_ballot_display }}*</b>]</font>
{% endif %} {{ comment.comment_text|format_textarea|truncatewords_html:"25" }}</td>

        <!-- this form element technically belongs inside the <td>
             but that actually changes the visible spacing in most
             browsers, so we let layout concerns make us write
             invalid HTML. -->
        <form action="{{ comment.get_absolute_url }}" method="GET">
          <td>
            <input type="submit" value="View Detail">
          </td>
        </form>
{% ifequal comment.get_username user.username %}
        <form action="." method="GET">
           <td>
            <input type="hidden" name="objectid" value="{{ comment.id }}">
            <input type="submit" value="Toggle Private/Public" name="toggle_public_flag">
          </td> 
        </form>
{% endifequal %}
      </tr>
    {% endifnotequal %}
  {% endif %}
{% endfor %} 
    </table>
    <br>
{% endif %}

    <form action="{% url ietf.idtracker.views.search %}" method="GET">
      <input type="submit" value="Main Menu">
      <input type="button" name="back_button" value="BACK"
        onclick="history.go(-1);return true">
    </form>

{% endblock %}
